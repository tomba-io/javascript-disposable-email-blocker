/**
* disposable-email-blocker version 1.3.0
* @license MIT
* 
* @copyright Mohamed Ben rebia <b.mohamed@tomba.io> (https://github.com/benemohamed)
* @homepage https://tomba.io
* @see README and LICENSE for details
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Disposable={})}(this,(function(e){"use strict";function t(e){return null!==e&&"object"==typeof e}function i(e,s,a=".",o){if(!t(s))return i(e,{},a,o);const n=Object.assign({},s);for(const s in e){if("__proto__"===s||"constructor"===s)continue;const r=e[s];null!=r&&(o&&o(n,s,r,a)||(Array.isArray(r)&&Array.isArray(n[s])?n[s]=[...r,...n[s]]:t(r)&&t(n[s])?n[s]=i(r,n[s],(a?`${a}.`:"")+s.toString(),o):n[s]=r))}return n}const s=(...e)=>e.reduce(((e,t)=>i(e,t,"",a)),{});var a,o;const n={apiUrl:"https://api.tomba.io",disposable:{message:"Unfortunately, you cannot create an account with this email address."},webmail:{message:"Unfortunately, you cannot create an account with this webmail email.",block:!1},emailError:{className:"b_e",style:"\n        /* This is the style of our input error */\n        .b_i_e {\n            border-color: #ea868f;\n            padding-right: calc(1.5em + 0.75rem);\n            background-image: url(\"data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23dc3545' stroke='none'/%3e%3c/svg%3e\");\n            background-repeat: no-repeat;\n            background-position: right calc(0.375em + 0.1875rem) center;\n            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);\n          }\n          .b_i_e:focus {\n            border-color: #ea868f;\n            box-shadow: 0 0 0 0.25rem rgba(220,53,69,.25);\n          }\n          /* This is the style of our error messages */\n          .b_e {\n            width: 100%;\n            margin-top: 0.25rem;\n            font-size: .875em;\n            color: #ea868f;\n          }\n        "},data:[]};class r{constructor(e){this.onInput=async e=>{if(e){if(this.activeElement=document.activeElement,this.email=this.activeElement.value,"INPUT"===this.activeElement.tagName&&"email"===this.activeElement.type||"INPUT"===this.activeElement.tagName&&"email"===this.activeElement.name)if(this.activeElement.classList.add("b_i_e"),this.activeElement.after(this.emailError),this.activeElement.validity.valueMissing)this.emailError.innerHTML="You need to enter an email address.";else if(this.activeElement.validity.typeMismatch)this.emailError.innerHTML="The entered value needs to be an email address.";else if(this.activeElement.validity.tooShort)this.emailError.innerHTML=`Email should be at least ${this.activeElement.minLength} characters; you entered ${this.email.length}.`;else if(this.emailValidate(this.email)&&this.activeElement.validity.valid)if(this.valid=!0,this.domain=this.email.split("@")[1],this.options.data.length>0){const e=this.checkDomain(this.domain);e&&(e.disposable?(this.disposable=e.disposable,this.showError(this.options.disposable.message)):this.options.webmail.block&&e.webmail?(this.webmail=e.webmail,this.showError(this.options.webmail.message)):(this.disposable=e.disposable,this.hideError()))}else{const e=`${this.options.apiUrl}/v1/domain-status?domain=${this.domain}`,t={method:"GET",headers:{accept:"application/json, text/plain, */*"}};try{const i=await fetch(e,t);if(!i.ok)throw new Error("Api error, status = "+i.status);const s=await i.json();this.disposable=!1,this.hideError(),s.disposable?(this.disposable=s.disposable,this.showError(this.options.disposable.message)):this.options.webmail.block&&s.webmail?(this.webmail=s.webmail,this.showError(this.options.webmail.message)):(this.disposable=s.disposable,this.hideError())}catch(e){console.error("Error:",e)}}else this.disposable=!1,this.showError("Invalid email address.");this.customEvent("done",{domain:this.domain,disposable:this.disposable,webmail:this.webmail})}},this.onSubmit=e=>{if(e&&(this.disposable||!this.valid||this.valid&&this.options.webmail.block&&this.webmail)){const t=e.target.closest("form");if(t&&this.activeForm==t){const i=t.querySelectorAll("input");if(i.length>0)for(let t=0;t<i.length;t++)"email"!==i[t].type&&"email"!==i[t].name||(e.preventDefault(),this.activeElement.focus())}}},this.onMouse=e=>{if(e){const e=document.activeElement;("INPUT"===e.tagName&&"email"===e.type||"INPUT"===e.tagName&&"email"===e.name)&&(this.activeElement=e,this.valid?this.disposable?this.showError(this.options.disposable.message):this.webmail?this.showError(this.options.webmail.message):this.hideError():this.showError("You need to enter an email address."))}},this.onClick=e=>{if(e){const t=e.target.closest("form");if(t){this.activeForm=t;const e=t.querySelectorAll('input[type="email"], input[name="email"]');if(e.length>0){for(let t=0;t<e.length;t++)"email"!==e[t].type&&"email"!==e[t].name||(this.activeElement=e[t]);this.onSubmit}}}},this.options=s(e||{},n),this.init(),this.addStyle(),this.emailError=this.createErrorElement(),this.emailError.className=this.options.emailError.className,this.disposable=!1,this.webmail=!1,this.valid=!1,this.domain=""}init(){this.inputHandlers(),this.clickHandlers(),this.submitHandlers(),this.mouseHandlers()}inputHandlers(){document.addEventListener("input",this.onInput)}clickHandlers(){document.addEventListener("click",this.onClick)}submitHandlers(){document.addEventListener("submit",this.onSubmit)}mouseHandlers(){document.addEventListener("mouseover",this.onMouse)}addStyle(){const e=document.createElement("style");e.innerHTML=this.options.emailError.style,document.head.appendChild(e)}createErrorElement(){const e=document.createElement("div");return e.className=this.options.emailError.className,e}showError(e){this.activeElement.classList.add("b_i_e"),this.activeElement.after(this.emailError),this.emailError.innerHTML=e,this.emailError.className="b_e"}hideError(){this.activeElement.classList.remove("b_i_e"),this.emailError.innerHTML="",this.emailError.className=""}emailValidate(e){return!1!==/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}checkDomain(e){return this.options.data.find((t=>t.domain===e))}customEvent(e,t){const i=new CustomEvent(e,{detail:t});document.dispatchEvent(i)}on(e,t){document.addEventListener(e,t)}}""===(null===(o=document.currentScript)||void 0===o?void 0:o.getAttribute("block"))&&new r,e.Blocker=r,Object.defineProperty(e,"__esModule",{value:!0})}));
